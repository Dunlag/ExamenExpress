<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap');
        body{
            font-family: "Geist", sans-serif;
        }
        </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container">
          <a class="navbar-brand" href="#">Navbar</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
              <a class="nav-link" href="#">Features</a>
              <a class="nav-link" href="#">Pricing</a>
              <a class="nav-link disabled" aria-disabled="true">Disabled</a>
            </div>
          </div>
        </div>
      </nav>
    <div class="container mt-4">
        <h1 class="mb-4"><%= title %></h1>

        <button id="addMovieBtn" class="btn btn-success mb-3">Añadir Película</button>

        <table id="moviesTable" class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Género</th>
                    <th>Año</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <footer class="container d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <p class="col-md-4 mb-0 text-body-secondary">© 2024 Company, Inc</p>
    
        <a href="/" class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <i class="bi bi-code-slash"></i>
        </a>
    
        <ul class="nav col-md-4 justify-content-end">
          <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary">Home</a></li>
          <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary">Features</a></li>
          <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary">Pricing</a></li>
          <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary">FAQs</a></li>
          <li class="nav-item"><a href="#" class="nav-link px-2 text-body-secondary">About</a></li>
        </ul>
      </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            let table = $('#moviesTable').DataTable({
                ajax: '/api/peliculas',
                columns: [
                    { data: 'id' },
                    { data: 'titulo' },
                    { data: 'genero' },
                    { data: 'anio' },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return `<button class="btn btn-danger btn-sm delete-btn" data-id="${row.id}">Eliminar</button>`;
                        }
                    }
                ]
            });

            // Añadir película
            $('#addMovieBtn').on('click', function () {
                Swal.fire({
                    title: 'Añadir Película',
                    html: `
                        <input id="swal-title" class="swal2-input" placeholder="Título">
                        <input id="swal-genero" class="swal2-input" placeholder="Género">
                        <input id="swal-anio" class="swal2-input" type="number" placeholder="Año">
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Añadir',
                    preConfirm: () => {
                        let titulo = document.getElementById('swal-title').value;
                        let genero = document.getElementById('swal-genero').value;
                        let anio = document.getElementById('swal-anio').value;

                        if (!titulo || !genero || !anio) {
                            Swal.showValidationMessage('Todos los campos son obligatorios');
                        }
                        return { titulo, genero, anio };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.post('/api/peliculas', result.value, function () {
                            table.ajax.reload();
                            Swal.fire('Éxito', 'Película añadida', 'success');
                        });
                    }
                });
            });

            // Eliminar película
            $('#moviesTable tbody').on('click', '.delete-btn', function () {
                let id = $(this).data('id');
                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "Esta acción no se puede deshacer",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Sí, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: `/api/peliculas/${id}`,
                            type: 'DELETE',
                            success: function () {
                                table.ajax.reload();
                                Swal.fire('Eliminado', 'Película eliminada', 'success');
                            }
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>

